# Приветственное приложение Codex

Этот репозиторий содержит минимальное приложение [Symfony](https://symfony.com/), которое на корневом маршруте отвечает фразой **«Hello codex!»**.

## Начало работы

1. Установите зависимости PHP (Composer уже включён в проект):
   ```bash
   composer install
   ```
2. Примените SQLite-миграции, чтобы создать таблицу журнала посещений:
   ```bash
   php bin/console app:sqlite:migrate
   ```
3. Запустите локальный сервер разработки из корня проекта:
   ```bash
   php -S 0.0.0.0:8000 -t public
   ```
4. Откройте http://localhost:8000 в браузере. Вы увидите сообщение `Hello codex!`, которое выводит приложение Symfony.

## Запуск в Docker

1. Укажите ключ доступа для LLM, чтобы избежать ошибки «Ключ доступа к модели ещё не настроен. Добавьте переменную окружения LLM_KEY и обновите страницу.» при открытии чата.
   Добавьте строку `LLM_KEY=ваш_ключ` в файл `.env.local` перед сборкой контейнера или запустите Docker Compose с переменной окружения:
   ```bash
   LLM_KEY=ваш_ключ docker compose up --build
   ```
2. Соберите образ и запустите контейнеры при помощи Docker Compose:
   ```bash
   docker compose up --build
   ```
3. Контейнер автоматически применит все SQL-миграции при запуске, поэтому журнал посещений готов к записи сразу же.
4. Откройте http://localhost:8000, чтобы увидеть ответ `Hello codex!` от приложения.
5. Для остановки контейнеров используйте сочетание `Ctrl+C` в терминале или выполните:
   ```bash
   docker compose down
   ```

> Если требуется вручную переинициализировать базу данных внутри Docker-контейнера, выполните команду
> `docker compose run --rm app php bin/console app:sqlite:migrate`.

Контейнер собирается на базе официального образа `php:8.4-cli`, поэтому приложение сразу запускается на актуальной версии PHP.

## Тестирование

- Запустите PHPUnit напрямую на вашей машине:
  ```bash
  composer test
  ```
- При необходимости выполните тесты напрямую через бинарник:
  ```bash
  ./bin/phpunit
  ```
- Или выполните тесты внутри контейнера, чтобы убедиться, что сборка корректна:
  ```bash
  docker compose run --rm -e APP_ENV=test -e APP_DEBUG=1 app ./bin/phpunit
  ```

## Структура проекта

- `src/Controller/HelloController.php` содержит контроллер, который отвечает за приветствие.
- `config/routes.yaml` включает конфигурацию маршрутов на основе атрибутов для контроллеров в `src/Controller`.

Дополняйте это стартовое приложение новыми маршрутами, шаблонами или сервисами по мере необходимости.
